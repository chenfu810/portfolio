<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Portfolio Pulse</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,400;9..144,600;9..144,700&family=Space+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css?v=20260207-8" />
    <link rel="icon" href="favicon.svg" type="image/svg+xml" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  </head>
  <body>
    <div class="bg-orb orb-1"></div>
    <div class="bg-orb orb-2"></div>
    <div class="bg-grid"></div>

    <main class="app">
      <header class="topbar">
        <div>
          <p class="eyebrow">Portfolio Pulse</p>
          <h1>Track your portfolio at a glance.</h1>
        </div>
        <button id="refreshBtn" class="ghost-btn">Refresh</button>
      </header>

      <section class="hero">
        <div class="hero-card">
          <p class="label">Total Value</p>
          <h2 id="totalValue">$0</h2>
          <p id="dailyChange" class="delta">+0.00% today</p>
          <p class="note">Daily change uses your sheet’s “daily change %”.</p>
        </div>
        <div class="hero-card highlight">
          <p class="label">Top Mover</p>
          <h3 id="topMover">—</h3>
          <p id="topMoverDelta" class="delta">—</p>
          <div class="mini-grid">
            <div>
              <p class="label">Daily P/L</p>
              <p id="dailyPL">$0</p>
            </div>
            <div>
              <p class="label">Monthly P/L</p>
              <p id="monthlyPL">Add column</p>
            </div>
            <div>
              <p class="label">Yearly P/L</p>
              <p id="yearlyPL">Add column</p>
            </div>
          </div>
        </div>
      </section>

      <section class="panel daily-panel">
        <div class="panel-header">
          <div>
            <h3>Daily Gain / Loss</h3>
            <p id="dailyTotalPLMeta" class="subtle">Today</p>
          </div>
          <p id="dailyTotalPL" class="daily-total">$0</p>
        </div>
        <div id="dailyCalendarMonths" class="daily-calendar-months"></div>
        <div id="dailyCalendarEmpty" class="empty" style="display: none">
          Daily changes are saved automatically in this browser (from Feb 2026).
        </div>
      </section>

      <section class="panel">
        <div class="panel-header">
          <h3>Expert Advice</h3>
          <div class="advice-controls">
            <select id="adviceSource" class="sort-select">
              <option value="built_in">Portfolio Pulse Analyst</option>
              <option value="chatgpt">ChatGPT Prompt</option>
              <option value="claude">Claude Prompt</option>
              <option value="gemini">Gemini Prompt</option>
              <option value="perplexity">Perplexity Prompt</option>
            </select>
            <select id="adviceMode" class="sort-select">
              <option value="balanced">Balanced</option>
              <option value="defensive">Defensive</option>
              <option value="growth">Growth</option>
              <option value="active">Active Trading</option>
            </select>
            <button id="adviceRefresh" class="ghost-btn small">Refresh Advice</button>
          </div>
        </div>
        <p id="adviceMeta" class="subtle">Advice based on your holdings and loaded market news.</p>
        <ul id="adviceList" class="advice-list"></ul>
        <div id="advicePromptWrap" class="advice-prompt-wrap" style="display: none">
          <div class="advice-prompt-header">
            <a id="adviceExternalLink" href="#" target="_blank" rel="noopener noreferrer">Open AI Tool</a>
            <button id="copyAdvicePrompt" class="ghost-btn small">Copy Prompt</button>
          </div>
          <textarea id="advicePrompt" class="advice-prompt" readonly></textarea>
        </div>
      </section>

      <section class="panel">
        <div class="panel-header">
          <h3>Market News Digest</h3>
          <div class="advice-controls">
            <select id="newsSource" class="sort-select">
              <option value="all">All Sources</option>
              <option value="cnbc">CNBC</option>
              <option value="yahoo">Yahoo Finance</option>
              <option value="reuters">Reuters</option>
            </select>
            <select id="newsFocus" class="sort-select">
              <option value="all">All Market</option>
              <option value="macro">Macro / Fed</option>
              <option value="earnings">Earnings</option>
              <option value="tech">Technology</option>
            </select>
            <button id="newsRefresh" class="ghost-btn small">Refresh News</button>
          </div>
        </div>
        <p id="newsMeta" class="subtle">Loading latest headlines...</p>
        <div id="newsList" class="news-list"></div>
      </section>

      <section class="panel">
        <div class="panel-header">
          <div>
            <h3>Allocation Map</h3>
            <p class="subtle">Size = value (shares x price), color = daily %.</p>
          </div>
          <div id="treemapBreadcrumb" class="breadcrumb">All Stocks</div>
        </div>
        <div id="treemap" class="treemap"></div>
      </section>

      <section class="panel">
        <div class="panel-header">
          <h3>Portfolio Value Over Time</h3>
          <p class="subtle">Uses a separate history tab if provided.</p>
        </div>
        <div id="historyEmpty" class="empty">
          Add a history tab with columns: <span class="mono">date</span>,
          <span class="mono">total value</span>.
        </div>
        <canvas id="historyChart"></canvas>
      </section>

      <section class="panel table-panel">
        <div class="panel-header">
          <h3>Holdings</h3>
          <div class="sort-wrap" id="holdingsSortToggle" role="group" aria-label="Sort holdings">
            <span class="sort-label">Sort by</span>
            <button type="button" class="sort-pill active" data-sort="value">Value</button>
            <button type="button" class="sort-pill" data-sort="daily">Daily %</button>
          </div>
        </div>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Ticker</th>
                <th>Shares</th>
                <th>Price</th>
                <th>Daily %</th>
                <th>Value</th>
              </tr>
            </thead>
            <tbody id="holdingsTable"></tbody>
          </table>
        </div>
      </section>

      <section class="panel footer">
        <p>
          Data source:
          <span id="sourceLabel" class="mono">Sample data</span>
        </p>
      </section>
    </main>

    <script src="app.js?v=20260207-11"></script>
  </body>
</html>
